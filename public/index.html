<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MX BINGO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <style>
        /* ... (existing CSS remains the same) ... */

        /* New styles for background upload feature */
        .background-upload-section {
            margin-top: 20px;
        }

        .background-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .background-upload-area:hover {
            border-color: #FF6B35;
            background: rgba(0, 0, 0, 0.3);
        }

        .background-upload-area i {
            font-size: 3rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
        }

        .background-upload-area p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
        }

        .background-upload-area small {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.85rem;
        }

        #backgroundUploadInput {
            display: none;
        }

        .background-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .background-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
            aspect-ratio: 16/9;
        }

        .background-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .background-item.active {
            border-color: #FF6B35;
            box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.5);
        }

        .background-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .background-item-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .background-item-name {
            color: white;
            font-size: 0.75rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70px;
        }

        .background-item-delete {
            background: rgba(239, 71, 111, 0.8);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            transition: var(--transition);
        }

        .background-item-delete:hover {
            background: #EF476F;
            transform: scale(1.1);
        }

        .background-selection {
            margin-bottom: 20px;
        }

        .background-selection label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
        }

        .background-selection select {
            width: 100%;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 0.95rem;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }

        .background-selection select:focus {
            outline: none;
            border-color: #FF6B35;
        }

        .background-type-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .background-type-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: var(--transition);
        }

        .background-type-btn.active {
            background: #FF6B35;
            color: white;
            border-color: #FF6B35;
        }

        .upload-progress {
            margin-top: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 10px;
            display: none;
        }

        .upload-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6B35, #FFD166);
            width: 0%;
            transition: width 0.3s ease;
        }

        .no-backgrounds-message {
            text-align: center;
            padding: 30px;
            color: rgba(255, 255, 255, 0.5);
            font-style: italic;
        }

        /* Netlify form styles */
        .netlify-form {
            display: none;
        }

        @media (max-width: 480px) {
            .background-preview {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .background-item {
                aspect-ratio: 4/3;
            }
        }
    </style>
</head>
<body>
    <!-- ... (existing HTML remains the same until admin panel) ... -->

    <!-- Admin Panel -->
    <div class="admin-panel hidden" id="adminPanel">
        <!-- Settings Tab -->
        <div class="tab-content active" id="settingsTab">
            <!-- ... (existing sections remain the same) ... -->
            
            <div class="admin-section">
                <h3><i class="fas fa-palette"></i> Background Settings</h3>
                
                <!-- Background Type Selector -->
                <div class="background-type-selector">
                    <div class="background-type-btn active" data-type="color">Color</div>
                    <div class="background-type-btn" data-type="image">Image</div>
                </div>
                
                <!-- Color Background Settings (existing) -->
                <div id="colorBackgroundSettings">
                    <div class="control-group">
                        <label>Background Color</label>
                        <div class="color-picker-container">
                            <div class="color-preview" id="bgColorPreview" style="background: #1a1a2e;"></div>
                            <div class="color-input">
                                <input type="text" id="bgColorInput" value="#1a1a2e" readonly>
                            </div>
                        </div>
                        <input type="color" id="bgColorPicker" value="#1a1a2e" style="display: none;">
                        <div class="color-palette" id="bgColorPalette"></div>
                    </div>
                </div>
                
                <!-- Image Background Settings (new) -->
                <div id="imageBackgroundSettings" style="display: none;">
                    <!-- Background Image Upload -->
                    <div class="background-upload-section">
                        <div class="background-upload-area" id="backgroundUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload background image</p>
                            <small>Recommended size: 1920x1080px (16:9 ratio)<br>
                            Max file size: 5MB<br>
                            Supported formats: JPG, PNG, GIF, WebP</small>
                            <input type="file" id="backgroundUploadInput" accept="image/*">
                        </div>
                        
                        <!-- Upload Progress -->
                        <div class="upload-progress" id="uploadProgress">
                            <div class="upload-progress-bar" id="uploadProgressBar"></div>
                        </div>
                        
                        <!-- Background Image Selection -->
                        <div class="background-selection">
                            <label>Select Background Image</label>
                            <select id="backgroundImageSelect">
                                <option value="">No background image</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        
                        <!-- Background Images Preview -->
                        <div class="background-preview" id="backgroundPreview">
                            <!-- Background items will be added here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ... (rest of existing admin panel remains the same) ... -->
        </div>
        
        <!-- ... (rest of existing HTML remains the same) ... -->
    </div>

    <!-- ... (existing modals and notifications remain the same) ... -->

    <!-- Netlify Form (hidden, for background upload) -->
    <form class="netlify-form" id="backgroundUploadForm" name="background-upload" method="POST" enctype="multipart/form-data" data-netlify="true">
        <input type="file" name="background-image" id="netlifyUploadInput">
        <input type="hidden" name="form-name" value="background-upload">
        <input type="hidden" name="admin-secret" id="adminSecret" value="">
        <button type="submit" id="netlifySubmitBtn">Submit</button>
    </form>

    <script>
        // ===========================================
        // NETLIFY CONFIGURATION FOR MX BINGO
        // ===========================================
        
        // Since we're using Netlify, we'll store data in:
        // 1. Netlify Forms for background image uploads
        // 2. LocalStorage for settings (or consider using Netlify Functions for a database)
        
        // For production, you should set up Netlify Functions and a database like FaunaDB
        // For simplicity in this example, we'll use LocalStorage and Netlify Forms

        // App state
        let currentUser = null;
        let isAdmin = false;
        let playerCards = [];
        let currentCardIndex = 0;
        let gameSettings = {
            maxPlayers: 50,
            cardsPerPlayer: 3,
            gameActive: false,
            cellColor: "#4361ee",
            cellNumberColor: "#ffffff",
            cellNumberSize: 16,
            cellSpacing: 8,
            cellBorder: "2px solid #4361ee",
            bgColor: "#1a1a2e",
            bgType: "color", // "color" or "image"
            bgImage: "", // URL of selected background image
            headerText: "MX BINGO",
            welcomeText: "Welcome to MX BINGO!",
            cardTitleText: "GAME CARD {current}/{total}",
            generalPassword: "bingo123",
            adminId: "admin",
            adminPassword: "1234",
            playerNameColor: "#ffffff",
            playerNameSize: 35,
            allowedPlayers: []
        };

        // Background images storage
        let backgroundImages = [];

        // DOM Elements for new background feature
        const backgroundUploadArea = document.getElementById('backgroundUploadArea');
        const backgroundUploadInput = document.getElementById('backgroundUploadInput');
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadProgressBar = document.getElementById('uploadProgressBar');
        const backgroundImageSelect = document.getElementById('backgroundImageSelect');
        const backgroundPreview = document.getElementById('backgroundPreview');
        const colorBackgroundSettings = document.getElementById('colorBackgroundSettings');
        const imageBackgroundSettings = document.getElementById('imageBackgroundSettings');
        const backgroundTypeSelector = document.querySelectorAll('.background-type-btn');
        const backgroundUploadForm = document.getElementById('backgroundUploadForm');
        const netlifyUploadInput = document.getElementById('netlifyUploadInput');
        const adminSecretInput = document.getElementById('adminSecret');
        const netlifySubmitBtn = document.getElementById('netlifySubmitBtn');

        // Initialize background images from localStorage
        function loadBackgroundImages() {
            const storedImages = localStorage.getItem('mxbingo_backgrounds');
            if (storedImages) {
                backgroundImages = JSON.parse(storedImages);
                updateBackgroundSelection();
            }
        }

        // Save background images to localStorage
        function saveBackgroundImages() {
            localStorage.setItem('mxbingo_backgrounds', JSON.stringify(backgroundImages));
        }

        // Update background selection dropdown and preview
        function updateBackgroundSelection() {
            // Clear existing options (keep the "No background image" option)
            while (backgroundImageSelect.options.length > 1) {
                backgroundImageSelect.remove(1);
            }
            
            // Clear preview
            backgroundPreview.innerHTML = '';
            
            if (backgroundImages.length === 0) {
                backgroundPreview.innerHTML = '<div class="no-backgrounds-message">No background images uploaded yet</div>';
                return;
            }
            
            // Add options to select dropdown
            backgroundImages.forEach((image, index) => {
                const option = document.createElement('option');
                option.value = image.url;
                option.textContent = image.name;
                if (gameSettings.bgImage === image.url) {
                    option.selected = true;
                }
                backgroundImageSelect.appendChild(option);
                
                // Add to preview gallery
                const backgroundItem = document.createElement('div');
                backgroundItem.className = `background-item ${gameSettings.bgImage === image.url ? 'active' : ''}`;
                backgroundItem.dataset.index = index;
                backgroundItem.innerHTML = `
                    <img src="${image.url}" alt="${image.name}" loading="lazy">
                    <div class="background-item-overlay">
                        <span class="background-item-name">${image.name}</span>
                        <button class="background-item-delete" data-index="${index}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                backgroundPreview.appendChild(backgroundItem);
                
                // Add click event to select this background
                backgroundItem.addEventListener('click', function(e) {
                    if (!e.target.closest('.background-item-delete')) {
                        selectBackgroundImage(index);
                    }
                });
                
                // Add delete event
                const deleteBtn = backgroundItem.querySelector('.background-item-delete');
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const index = parseInt(this.getAttribute('data-index'));
                    deleteBackgroundImage(index);
                });
            });
        }

        // Select a background image
        function selectBackgroundImage(index) {
            if (backgroundImages[index]) {
                gameSettings.bgImage = backgroundImages[index].url;
                gameSettings.bgType = "image";
                
                // Update UI
                backgroundImageSelect.value = gameSettings.bgImage;
                
                // Update active state in preview
                document.querySelectorAll('.background-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelectorAll('.background-item')[index].classList.add('active');
                
                // Update background type selector
                document.querySelectorAll('.background-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.background-type-btn[data-type="image"]').classList.add('active');
                colorBackgroundSettings.style.display = 'none';
                imageBackgroundSettings.style.display = 'block';
                
                // Apply background
                applyBackground();
                
                // Save settings
                saveSettings();
                
                showNotification(`Background image "${backgroundImages[index].name}" selected`);
            }
        }

        // Delete a background image
        function deleteBackgroundImage(index) {
            if (confirm(`Delete "${backgroundImages[index].name}"? This cannot be undone.`)) {
                // If this was the active background, clear it
                if (gameSettings.bgImage === backgroundImages[index].url) {
                    gameSettings.bgImage = "";
                    gameSettings.bgType = "color";
                    backgroundImageSelect.value = "";
                    
                    // Switch back to color background
                    document.querySelectorAll('.background-type-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    document.querySelector('.background-type-btn[data-type="color"]').classList.add('active');
                    colorBackgroundSettings.style.display = 'block';
                    imageBackgroundSettings.style.display = 'none';
                    
                    applyBackground();
                }
                
                backgroundImages.splice(index, 1);
                saveBackgroundImages();
                updateBackgroundSelection();
                saveSettings();
                
                showNotification('Background image deleted');
            }
        }

        // Handle background upload
        backgroundUploadArea.addEventListener('click', function() {
            backgroundUploadInput.click();
        });

        backgroundUploadInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                uploadBackgroundImage(e.target.files[0]);
            }
        });

        // Upload background image
        function uploadBackgroundImage(file) {
            // Validate file
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            
            if (file.size > maxSize) {
                showNotification('File size must be less than 5MB', false);
                return;
            }
            
            if (!allowedTypes.includes(file.type)) {
                showNotification('Only JPG, PNG, GIF, and WebP images are allowed', false);
                return;
            }
            
            // Show upload progress
            uploadProgress.style.display = 'block';
            uploadProgressBar.style.width = '0%';
            
            // For Netlify deployment, we'll use a simple approach
            // In a real implementation, you'd use Netlify Functions to handle uploads
            
            // Simulate upload progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                uploadProgressBar.style.width = `${progress}%`;
                
                if (progress >= 90) {
                    clearInterval(progressInterval);
                    
                    // Create a local URL for the image (for demo purposes)
                    // In production, you would upload to Netlify's storage or a CDN
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Add the image to our collection
                        const imageData = {
                            name: file.name.replace(/\.[^/.]+$/, ""), // Remove extension
                            url: e.target.result,
                            size: file.size,
                            type: file.type,
                            uploadedAt: new Date().toISOString()
                        };
                        
                        backgroundImages.push(imageData);
                        saveBackgroundImages();
                        updateBackgroundSelection();
                        
                        // Complete progress bar
                        uploadProgressBar.style.width = '100%';
                        setTimeout(() => {
                            uploadProgress.style.display = 'none';
                        }, 1000);
                        
                        showNotification(`Background "${imageData.name}" uploaded successfully`);
                        
                        // For Netlify Forms (optional - would need server-side processing)
                        // To actually upload to Netlify, you'd need to:
                        // 1. Set up a Netlify form with file upload
                        // 2. Use the Netlify Forms API
                        // 3. Or use Netlify Functions with a storage service
                        
                        // For now, we're storing images locally in localStorage
                        // Note: localStorage has size limits, so for production,
                        // you should use a proper storage solution
                    };
                    reader.readAsDataURL(file);
                }
            }, 100);
        }

        // Background type selector
        backgroundTypeSelector.forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.getAttribute('data-type');
                
                // Update active button
                backgroundTypeSelector.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Show appropriate settings
                if (type === 'color') {
                    colorBackgroundSettings.style.display = 'block';
                    imageBackgroundSettings.style.display = 'none';
                    gameSettings.bgType = "color";
                    applyBackground();
                } else {
                    colorBackgroundSettings.style.display = 'none';
                    imageBackgroundSettings.style.display = 'block';
                    gameSettings.bgType = "image";
                    applyBackground();
                }
                
                saveSettings();
            });
        });

        // Background image selection change
        backgroundImageSelect.addEventListener('change', function() {
            gameSettings.bgImage = this.value;
            
            if (gameSettings.bgImage) {
                gameSettings.bgType = "image";
                
                // Update active state in preview
                document.querySelectorAll('.background-item').forEach((item, index) => {
                    if (backgroundImages[index] && backgroundImages[index].url === gameSettings.bgImage) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // Update background type selector
                document.querySelectorAll('.background-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.background-type-btn[data-type="image"]').classList.add('active');
                colorBackgroundSettings.style.display = 'none';
                imageBackgroundSettings.style.display = 'block';
            } else {
                gameSettings.bgType = "color";
            }
            
            applyBackground();
            saveSettings();
        });

        // Apply background based on settings
        function applyBackground() {
            if (gameSettings.bgType === "color") {
                document.body.style.background = `linear-gradient(135deg, ${gameSettings.bgColor} 0%, ${adjustColor(gameSettings.bgColor, -20)} 100%)`;
                document.body.style.backgroundImage = 'none';
            } else if (gameSettings.bgType === "image" && gameSettings.bgImage) {
                document.body.style.background = `linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url("${gameSettings.bgImage}")`;
                document.body.style.backgroundSize = 'cover';
                document.body.style.backgroundPosition = 'center';
                document.body.style.backgroundAttachment = 'fixed';
                document.body.style.backgroundRepeat = 'no-repeat';
            } else {
                // Fallback to color
                document.body.style.background = `linear-gradient(135deg, ${gameSettings.bgColor} 0%, ${adjustColor(gameSettings.bgColor, -20)} 100%)`;
                document.body.style.backgroundImage = 'none';
            }
        }

        // Save settings to localStorage (replacing Firebase)
        async function saveSettings() {
            localStorage.setItem('mxbingo_settings', JSON.stringify(gameSettings));
            
            // If admin, also update the displayed texts
            if (isAdmin) {
                headerTitle.textContent = gameSettings.headerText;
                welcomeText.textContent = gameSettings.welcomeText;
            }
            
            showNotification('Settings saved successfully!');
        }

        // Load settings from localStorage (replacing Firebase)
        async function loadSettings() {
            const storedSettings = localStorage.getItem('mxbingo_settings');
            if (storedSettings) {
                const loadedSettings = JSON.parse(storedSettings);
                gameSettings = { ...gameSettings, ...loadedSettings };
                
                // Update UI with loaded settings
                updateSettingsUI();
                
                // Apply styling
                applyCellStyling();
                applyBackground();
            }
        }

        // Update settings UI (replacing Firebase version)
        function updateSettingsUI() {
            if (!isAdmin) return;
            
            maxPlayersInput.value = gameSettings.maxPlayers;
            cardsPerPlayerInput.value = gameSettings.cardsPerPlayer;
            gameActiveSelect.value = gameSettings.gameActive.toString();
            cellNumberSizeInput.value = gameSettings.cellNumberSize || 16;
            cellSpacingInput.value = gameSettings.cellSpacing || 8;
            cellBorderInput.value = gameSettings.cellBorder || "2px solid #4361ee";
            headerTextInput.value = gameSettings.headerText || "MX BINGO";
            welcomeTextInput.value = gameSettings.welcomeText || "Welcome to MX BINGO!";
            cardTitleTextInput.value = gameSettings.cardTitleText || "GAME CARD {current}/{total}";
            generalPasswordInput.value = gameSettings.generalPassword || "bingo123";
            adminIdInput.value = gameSettings.adminId || "admin";
            adminPasswordInput.value = gameSettings.adminPassword || "1234";
            playerNameSizeInput.value = gameSettings.playerNameSize || 35;
            
            // Update color inputs
            playerNameColorInput.value = gameSettings.playerNameColor || "#ffffff";
            playerNameColorPreview.style.backgroundColor = gameSettings.playerNameColor || "#ffffff";
            playerNameColorPicker.value = gameSettings.playerNameColor || "#ffffff";
            
            cellColorInput.value = gameSettings.cellColor || "#4361ee";
            cellColorPreview.style.backgroundColor = gameSettings.cellColor || "#4361ee";
            cellColorPicker.value = gameSettings.cellColor || "#4361ee";
            
            cellNumberColorInput.value = gameSettings.cellNumberColor || "#ffffff";
            cellNumberColorPreview.style.backgroundColor = gameSettings.cellNumberColor || "#ffffff";
            cellNumberColorPicker.value = gameSettings.cellNumberColor || "#ffffff";
            
            bgColorInput.value = gameSettings.bgColor || "#1a1a2e";
            bgColorPreview.style.backgroundColor = gameSettings.bgColor || "#1a1a2e";
            bgColorPicker.value = gameSettings.bgColor || "#1a1a2e";
            
            // Update background type
            if (gameSettings.bgType === "image") {
                document.querySelectorAll('.background-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.background-type-btn[data-type="image"]').classList.add('active');
                colorBackgroundSettings.style.display = 'none';
                imageBackgroundSettings.style.display = 'block';
                backgroundImageSelect.value = gameSettings.bgImage || "";
            } else {
                document.querySelectorAll('.background-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('.background-type-btn[data-type="color"]').classList.add('active');
                colorBackgroundSettings.style.display = 'block';
                imageBackgroundSettings.style.display = 'none';
            }
            
            // Update displayed texts
            headerTitle.textContent = gameSettings.headerText || "MX BINGO";
            welcomeText.textContent = gameSettings.welcomeText || "Welcome to MX BINGO!";
            
            // Update game status indicator
            updateGameStatusIndicator();
            
            // Initialize color pickers
            initializeColorPickers();
            
            // Render player list editor
            renderPlayerListEditor();
            updatePlayerCount();
            
            // Update background selection
            updateBackgroundSelection();
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Load settings and background images
            loadSettings();
            loadBackgroundImages();
            
            // Generate a sample preview card
            const previewCard = generateBingoCard();
            if (previewGrid) {
                renderBingoGrid(previewCard, previewGrid, true);
            }
            
            // Initialize color pickers
            initializeColorPickers();
            
            // Add initial player to list if empty
            if (!gameSettings.allowedPlayers || gameSettings.allowedPlayers.length === 0) {
                gameSettings.allowedPlayers = [
                    { name: "Player 1", luckyNumber: generateLuckyNumber() },
                    { name: "Player 2", luckyNumber: generateLuckyNumber() },
                    { name: "Player 3", luckyNumber: generateLuckyNumber() }
                ];
                saveSettings();
            }
            
            // Set admin secret for Netlify form (optional)
            adminSecretInput.value = gameSettings.adminPassword;
        });

        // Update the save settings button event listener
        saveSettingsBtn.addEventListener('click', async function() {
            // Update gameSettings object
            gameSettings = {
                maxPlayers: parseInt(maxPlayersInput.value),
                cardsPerPlayer: parseInt(cardsPerPlayerInput.value),
                gameActive: gameActiveSelect.value === 'true',
                cellColor: cellColorInput.value,
                cellNumberColor: cellNumberColorInput.value,
                cellNumberSize: parseInt(cellNumberSizeInput.value),
                cellSpacing: parseInt(cellSpacingInput.value),
                cellBorder: cellBorderInput.value,
                bgColor: bgColorInput.value,
                bgType: gameSettings.bgType || "color",
                bgImage: gameSettings.bgImage || "",
                headerText: headerTextInput.value,
                welcomeText: welcomeTextInput.value,
                cardTitleText: cardTitleTextInput.value,
                generalPassword: generalPasswordInput.value,
                adminId: adminIdInput.value,
                adminPassword: adminPasswordInput.value,
                playerNameColor: playerNameColorInput.value,
                playerNameSize: parseInt(playerNameSizeInput.value),
                allowedPlayers: gameSettings.allowedPlayers || []
            };
            
            // Save to localStorage
            await saveSettings();
            
            // Apply styling
            applyCellStyling();
            applyBackground();
            
            showNotification('All settings saved successfully!');
        });

        // ... (rest of existing JavaScript functions remain the same, 
        // but replace Firebase references with localStorage where needed)
    </script>
</body>
</html>